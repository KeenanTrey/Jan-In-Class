@{ 
    Layout = "~/_Layout.cshtml";
    Page.Title = "Demo webgrid: Serch products by category";

    var db = WebMatrix.Data.Database.Open("WestWindDb");
    var allCategories = db.Query("SELECT CategoryID, CategoryName FROM Categories");

    string categorySelection = Request[nameof(categorySelection)];
    List<SelectListItem> catOptions = new List<SelectListItem>();
    catOptions.Add(new SelectListItem { Value = "", Text = "[Select a category]" });
    foreach(var item in allCategories)
    {
        catOptions.Add(new SelectListItem { Text = item.CategoryName, Value = item.CategoryID.ToString() });
    }
}
<div>
    <h2>Search Products by category</h2>
    <form method="post">
        Category:
        @Html.DropDownList(nameof(categorySelection), catOptions)
        <button type="submit">Look up Products</button>
    </form>

    @if (IsPost)
    {
        <hr />
        int catId;
        if (!int.TryParse(categorySelection, out catId))
        {
            <div>Please select an actual category before clicking the look up button</div>
        }
        else
        {
            var products = db.Query("SELECT ProductID, ProductName, QuantityPerUnit, UnitPrice FROM Products WHERE CategoryID = @0", catId);
            //Create mygrid
            var myGrid = new WebGrid(products);
            <div>
                <h3>Products</h3>
                @myGrid.GetHtml()
            </div>
        }
    }
</div>